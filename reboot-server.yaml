---
- name: Reboot and wait
  hosts: all

  tasks:
    - name: Reboot machine and send a message
      ansible.builtin.reboot:
      msg: "Rebooting machine in 5 seconds"

    - name: Waiting for rebooting
      wait_for_connection:
        delay: 15
        sleep: 10
        timeout: 300

    - debug:
        msg: "{{ inventory_hostname }} is up and running"
